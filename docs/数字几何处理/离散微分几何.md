# 1 局部平均区域（Local Averaging Region）

![image-20220619080754497](https://qglh-tuchuang.oss-cn-hangzhou.aliyuncs.com/markdown_img/202206190807562.png)



# 2 法向量（Normal Vectors）

$\quad$ 对于每个三角面的法向量是唯一确定的，但是对于顶点法线可以定义为局部单环邻域中法向量的空间平均。计算公式如下：
$$
\mathbf{n}(v) = \frac{\sum_{T\in\Omega(v)} \alpha_T \ \mathbf{n}(T)}
{\|\sum_{T\in\Omega(v)}\alpha_T \ \mathbf{n}(T)\|}_2 \tag{1}
$$

1. 均值权：$\alpha_T = 1$
2. 三角形面积：$\alpha_T = area(T)$
3. 入射三角角度：$\alpha_T = \theta(T)$



# 3 重心坐标（Barycentric coordinate）

![image-20220619081520746](https://qglh-tuchuang.oss-cn-hangzhou.aliyuncs.com/markdown_img/202206190815772.png)

$\quad$ 对于重心坐标 $g$ ，其计算公式如下：
$$
g = \alpha g_i + \beta g_j + \gamma g_k \tag{2}
$$
$\quad$ 其中：

1. $\alpha + \beta + \gamma = 1$
2. $\alpha,\beta,\gamma \geq 0$
3. $\alpha = \dfrac{s_i}{s_i+s_j+s_k}$ ，其中 $s_i$ 是图中绿色区域，对于 $\beta,\gamma$ 计算公式可以类比。



# 4 梯度（Gradients）

$\quad$ 有分段线性函数 $f(\mathbf{x}) = \alpha f_i + \beta f_j + \gamma f_k$ 。梯度等于两端对 $\mathbf{x}$ 求偏导，即 

$$
\triangledown _xf(x)= f_i \triangledown _x \alpha + f_j \triangledown _x \beta + f_k \triangledown_x \gamma \tag{3}
$$

## 4.1 公式推导

$\quad$ 首先求 $\alpha$ ：
$$
\alpha = \frac{A_i}{A_T} = \frac
{\Bigg((x-x_j)\cdot \dfrac{(x_k-x_j)^\perp}{\|x_k-x_j\|_2}   \Bigg)\|x_k-x_j\|_2 }
{2A_T} =(x-x_j)\cdot\frac{(x_k-x_j)^\perp}{2A_T} \tag{4}
$$

1.  $(x_k-x_j)^\perp$ 代表 $(x_k - x_j)$  这个向量逆时针旋转 $90\degree$ 。
2. $\|x_k-x_j\|_2$ 代表 $(x_k-x_j)$ 这个向量的长度。
3. 本质上求 $A_i$ 是利用了三角形面积等于底乘高除2的公式。

$\quad$ 紧接着，再对 **公式（4）** 两边对 $x$ 求导，则可求得 $\triangledown_x\alpha$ ，其余同理可得：
$$
\triangledown _x \alpha = \dfrac{(x_k - x_j)^\perp}{2A_T} \\
\triangledown _x \beta = \dfrac{(x_i - x_k)^\perp}{2A_T}\\
\triangledown _x \gamma = \dfrac{(x_j - x_i)^\perp}{2A_T} \tag{5}
$$


